package me.warrior.common.json;

import me.warrior.common.model.Address;
import me.warrior.common.model.People;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class JSONMapperTest {

    @Test
    public void limit() throws IOException {
        List<Map<String, String>> mapList = new ArrayList<>(100000);
        int i = 0;
        while (i < 100000) {
            Map<String, String> map = new HashMap<>(5);
            map.put("name", "xxxx");
            map.put("age", "12");
            map.put("address", "xxxxxxxxxxxxxxxxxxxxx");
            map.put("job", "kdfjlsdjfksdjljdsljfkls");
            map.put("xdsf", "dfsdsfsdfsdfsdfsdf");
            map.put("name2", "xxxx");
            map.put("age3", "12");
            map.put("address4", "xxxxxxxxxxxxxxxxxxxxx");
            map.put("job5", "kdfjlsdjfksdjljdsljfkls");
            map.put("xdsf6", "dfsdsfsdfsdfsdfsdf"); map.put("address", "xxxxxxxxxxxxxxxxxxxxx");
            map.put("job2", "kdfjlsdjfksdjljdsljfkls");
            map.put("xdsf2", "dfsdsfsdfsdfsdfsdf");
            map.put("name22", "xxxx");
            mapList.add(map);
            i++;
        }

        String json = JSONMapper.toJSONString(mapList);
        System.out.println(json);

        List<Map<String, Object>> jsonList = JSONMapper.getInstance().fromJson(json, List.class);
        System.out.println(jsonList);
    }


    @Test
    public void complexObjectTest() {
        Address address = new Address("1", "苏州");
        People people = new People(10, "男", "张三", address);
        String json = JSONMapper.toJSONString(people);

        People people1 = JSONMapper.getInstance().fromJson(json, People.class);
        Assertions.assertEquals(people.getAddress().getUid(), people1.getAddress().getUid());

    }

    @Test
    public void parser() {
        String json = "{\"error\":true,\"timestamp\":\"2021-11-17T19:51:24.614989\",\"input\":{\"hscode\":\"4703210090\",\"factor_values\":\"4|3|\\u9488\\u53F6\\u6728|\\u6F02\\u767D|7.84%|INTERNATIONAL PAPER \\u724C|20190923|\\u5377\\u7B52|||7.3 dl\\/g\\/86.5%\\/0.28\"},\"detail\":{\"tag\":\"normal\",\"raw_factors\":[\"\\u54C1\\u724C\\u7C7B\\u578B\",\"\\u51FA\\u53E3\\u4EAB\\u60E0\\u60C5\\u51B5\",\"\\u6750\\u8D28\\uFF08\\u9488\\u53F6\\u6728\\u3001\\u975E\\u9488\\u53F6\\u6728\\uFF09\",\"\\u52A0\\u5DE5\\u65B9\\u6CD5\\uFF08\\u6F02\\u767D\\u3001\\u672A\\u6F02\\u767D\\u3001\\u534A\\u6F02\\u767D\\uFF09\",\"\\u6C34\\u5206\\u542B\\u91CF\",\"\\u54C1\\u724C\\uFF08\\u4E2D\\u6587\\u53CA\\u5916\\u6587\\u540D\\u79F0\\uFF09\",\"\\u7B7E\\u7EA6\\u65E5\\u671F\",\"\\u5F62\\u72B6\\uFF08\\u5377\\u7B52\\u6216\\u5E73\\u677F\\uFF09\",\"GTIN\",\"CAS\"],\"raw_factor_values\":[\"4\",\"3\",\"\\u9488\\u53F6\\u6728\",\"\\u6F02\\u767D\",\"7.84%\",\"INTERNATIONAL PAPER \\u724C\",\"20190923\",\"\\u5377\\u7B52\",\"\",\"\",\"7.3 dl\\/g\\/86.5%\\/0.28\"],\"factors\":[\"\\u54C1\\u724C\\u7C7B\\u578B\",\"\\u51FA\\u53E3\\u4EAB\\u60E0\\u60C5\\u51B5\",\"\\u6750\\u8D28 ( \\u9488\\u53F6\\u6728 \\u3001 \\u975E\\u9488\\u53F6\\u6728 )\",\"\\u52A0\\u5DE5\\u65B9\\u6CD5 ( \\u6F02\\u767D \\u3001 \\u672A\\u6F02\\u767D \\u3001 \\u534A\\u6F02\\u767D )\",\"\\u6C34\\u5206\\u542B\\u91CF\",\"\\u54C1\\u724C ( \\u4E2D\\u6587\\u53CA\\u5916\\u6587\\u540D\\u79F0 )\",\"\\u7B7E\\u7EA6\\u65E5\\u671F\",\"\\u5F62\\u72B6 ( \\u5377\\u7B52\\u6216\\u5E73\\u677F )\",\"gtin\",\"cas\",\"\\u5176\\u4ED6\"],\"factor_values\":[\"d\",\"d\",\"\\u9488\\u53F6\\u6728\",\"\\u6F02\\u767D\",\"d . dd %\",\"international paper \\u724C\",\"dddddddd\",\"\\u5377\\u7B52\",\"\",\"\",\"d . d dl \\/ g \\/ dd . d %\\/ d . dd\"],\"correct\":[{\"position\":0,\"raw_factor\":\"\\u54C1\\u724C\\u7C7B\\u578B\",\"raw_factor_value\":\"4\",\"factor\":\"\\u54C1\\u724C\\u7C7B\\u578B\",\"factor_value\":\"d\",\"source\":\"rule\",\"prob\":1.0},{\"position\":1,\"raw_factor\":\"\\u51FA\\u53E3\\u4EAB\\u60E0\\u60C5\\u51B5\",\"raw_factor_value\":\"3\",\"factor\":\"\\u51FA\\u53E3\\u4EAB\\u60E0\\u60C5\\u51B5\",\"factor_value\":\"d\",\"source\":\"rule\",\"prob\":1.0},{\"position\":8,\"raw_factor\":\"GTIN\",\"raw_factor_value\":\"\",\"factor\":\"gtin\",\"factor_value\":\"\",\"source\":\"rule\",\"prob\":1.0},{\"position\":9,\"raw_factor\":\"CAS\",\"raw_factor_value\":\"\",\"factor\":\"cas\",\"factor_value\":\"\",\"source\":\"rule\",\"prob\":1.0},{\"position\":2,\"raw_factor\":\"\\u6750\\u8D28\\uFF08\\u9488\\u53F6\\u6728\\u3001\\u975E\\u9488\\u53F6\\u6728\\uFF09\",\"raw_factor_value\":\"\\u9488\\u53F6\\u6728\",\"factor\":\"\\u6750\\u8D28 ( \\u9488\\u53F6\\u6728 \\u3001 \\u975E\\u9488\\u53F6\\u6728 )\",\"factor_value\":\"\\u9488\\u53F6\\u6728\",\"source\":\"model\",\"prob\":0.9995973706245422},{\"position\":3,\"raw_factor\":\"\\u52A0\\u5DE5\\u65B9\\u6CD5\\uFF08\\u6F02\\u767D\\u3001\\u672A\\u6F02\\u767D\\u3001\\u534A\\u6F02\\u767D\\uFF09\",\"raw_factor_value\":\"\\u6F02\\u767D\",\"factor\":\"\\u52A0\\u5DE5\\u65B9\\u6CD5 ( \\u6F02\\u767D \\u3001 \\u672A\\u6F02\\u767D \\u3001 \\u534A\\u6F02\\u767D )\",\"factor_value\":\"\\u6F02\\u767D\",\"source\":\"model\",\"prob\":0.9995656609535217},{\"position\":4,\"raw_factor\":\"\\u6C34\\u5206\\u542B\\u91CF\",\"raw_factor_value\":\"7.84%\",\"factor\":\"\\u6C34\\u5206\\u542B\\u91CF\",\"factor_value\":\"d . dd %\",\"source\":\"model\",\"prob\":0.9991488456726074},{\"position\":6,\"raw_factor\":\"\\u7B7E\\u7EA6\\u65E5\\u671F\",\"raw_factor_value\":\"20190923\",\"factor\":\"\\u7B7E\\u7EA6\\u65E5\\u671F\",\"factor_value\":\"dddddddd\",\"source\":\"model\",\"prob\":0.9964612126350403},{\"position\":7,\"raw_factor\":\"\\u5F62\\u72B6\\uFF08\\u5377\\u7B52\\u6216\\u5E73\\u677F\\uFF09\",\"raw_factor_value\":\"\\u5377\\u7B52\",\"factor\":\"\\u5F62\\u72B6 ( \\u5377\\u7B52\\u6216\\u5E73\\u677F )\",\"factor_value\":\"\\u5377\\u7B52\",\"source\":\"model\",\"prob\":0.9988434314727783}],\"incorrect\":[{\"position\":10,\"raw_factor\":null,\"raw_factor_value\":\"7.3 dl\\/g\\/86.5%\\/0.28\",\"factor\":\"\\u5176\\u4ED6\",\"factor_value\":\"7.3 dl\\/g\\/86.5%\\/0.28\",\"source\":\"rule\",\"prob\":1.0},{\"position\":5,\"raw_factor\":\"\\u54C1\\u724C\\uFF08\\u4E2D\\u6587\\u53CA\\u5916\\u6587\\u540D\\u79F0\\uFF09\",\"raw_factor_value\":\"INTERNATIONAL PAPER \\u724C\",\"factor\":\"\\u54C1\\u724C ( \\u4E2D\\u6587\\u53CA\\u5916\\u6587\\u540D\\u79F0 )\",\"factor_value\":\"international paper \\u724C\",\"source\":\"model\",\"prob\":7.225543959066272e-5}],\"uncertain\":[]}}";

//        String json = "{\"error\":false,\"timestamp\":\"2021-11-17T17:48:32.852721\",\"input\":{\"hscode\":\"2707999000\",\"factor_values\":\"4|3|\\u82b3\\u70c371.5%,\\u9971\\u548c\\u70c325.36%,\\u6781\\u6027\\u5316\\u5408\\u7269%,\\u68c0\\u6d4b\\u65b9\\u6cd5:SH\\/T 0753-2005|250\\u2103\\u84b8\\u998f\\u51fa\\u82b3\\u70c3\\u4f53\\u79ef\\u5c0f\\u4e8e1.5%|350-500\\u2103|\\u73b0\\u8d27\\u4ef7|\\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97|0226|20210226|\\u65e0\\u6ede\\u671f\\u8d39\"},\"detail\":{\"tag\":\"normal\",\"raw_factors\":[\"\\u54c1\\u724c\\u7c7b\\u578b\",\"\\u51fa\\u53e3\\u4eab\\u60e0\\u60c5\\u51b5\",\"\\u6210\\u5206\\u542b\\u91cf\\uff08\\u9u7528HS\\/T50\\u65b9\\u6cd5\\u6d4b\\u5f97\\u82b3\\u70c3\\u542b\\u91cf\\uff09\",\"\\u6309ISO3405\\u65b9\\u6cd5\\uff0c\\u6e29\\u5ea6\\u5728250\\u2103\\u65f6\\u4ee5\\u4f53\\u79ef\\u8ba1\\u7684\\u998f\\u51fa\\u91cfu998f\\u7a0b\\uff08\\u521d\\u998f\\u70b9\\u6e29\\u5ea6\\u53ca\\u7ec8\\u954f\\u70b9\\u6e29\\u5ea6\\u7b49\\uff09\",\"\\u5b9a\\u4ef7\\u65b9\\u5f0f\\uff08\\u516c\\u5f0f\\u5b9a\\u4ef7\\u3001\\u73b0\\u8d27\\u4ef7\\u7b4\"\\u9700\\u8981\\u4e8c\\u6b21\\u7ed3\\u7b97\\u3001\\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"\\u7b7e\\u7ea6\\u65e5\\u671f\",\"\\u8ba1\\u4ef7\\u65e5\\u671f\",\"\\u6709\\u65e0\\u6ede\\u671f\\u8d39\\uff08\\u65e0\\u6u671f\\u8d39\\u3001\\u6ede\\u671f\\u8d39\\u672a\\u786e\\u5b9a\\u3001\\u6ede\\u671f\\u8d39\\u5df2\\u7533\\u62a5\\uff09\",\"GTIN\",\"CAS\"],\"raw_factor_values\":[\"4\",\"3\",\"\\u82b3\\u70c371.5%,\\u9971\\u548c\\u70.36%,\\u6781\\u6027\\u5316\\u5408\\u72693.14%,\\u68c0\\u6d4b\\u65b9\\u6cd5:SH\\/T 0753-2005\",\"250\\u2103\\u84b8\\u998f\\u51fa\\u82b3\\u70c3\\u4f53\\u79ef\\u5c0f\\u4e8e1.5%\",\"350-500\\u2103\",\"\\u73b0\\u8d2ef7\",\"\\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"20210226\",\"20210226\",\"\\u65e0\\u6ede\\u671f\\u8d39\"],\"factors\":[\"\\u54c1\\u724c\\u7c7b\\u578b\",\"\\u51fa\\u53e3\\u4eab\\u60e0\\u60c5\\u51b5\",\"\\u6210\\u5u542b\\u91cf ( \\u9700\\u7528 hs \\/ t dd \\u65b9\\u6cd5\\u6d4b\\u5f97\\u82b3\\u70c3\\u542b\\u91cf )\",\"\\u6309 iso dddd \\u65b9\\u6cd5 , \\u6e29\\u5ea6\\u5728 ddd \\u00b0 C \\u65f6\\u4ee5\\u4f53\\u79ef\\u8u7684\\u998f\\u51fa\\u91cf\",\"\\u998f\\u7a0b ( \\u521d\\u998f\\u70b9\\u6e29\\u5ea6\\u53ca\\u7ec8\\u954f\\u70b9\\u6e29\\u5ea6\\u7b49 )\",\"\\u5b9a\\u4ef7\\u65b9\\u5f0f ( \\u516c\\u5f0f\\u5b9a\\u4ef7 \\u3001 \\u738d27\\u4ef7\\u7b49 )\",\"\\u9700\\u8981\\u4e8c\\u6b21\\u7ed3\\u7b97 \\u3001 \\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"\\u7b7e\\u7ea6\\u65e5\\u671f\",\"\\u8ba1\\u4ef7\\u65e5\\u671f\",\"\\u6709\\u65e0\\u6ede\\u671d39 ( \\u65e0\\u6ede\\u671f\\u8d39 \\u3001 \\u6ede\\u671f\\u8d39\\u672a\\u786e\\u5b9a \\u3001 \\u6ede\\u671f\\u8d39\\u5df2\\u7533\\u62a5 )\"],\"factor_values\":[\"d\",\"d\",\"\\u82b3\\u70c3 dd . d %, \\u9971\\u5u70c3 dd . dd %, \\u6781\\u6027\\u5316\\u5408\\u7269 d . dd %, \\u68c0\\u6d4b\\u65b9\\u6cd5 : sh \\/ t dddd - dddd\",\"ddd \\u00b0 C \\u84b8\\u998f\\u51fa\\u82b3\\u70c3\\u4f53\\u79ef\\u5c0f\\u4e8e d . d ddd - ddd \\u00b0 C\",\"\\u73b0\\u8d27\\u4ef7\",\"\\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"dddddddd\",\"dddddddd\",\"\\u65e0\\u6ede\\u671f\\u8d39\"],\"correct\":[{\"position\":0,\"raw_factor\":\"\\u54c1\\u724c7b\\u578b\",\"raw_factor_value\":\"4\",\"factor\":\"\\u54c1\\u724c\\u7c7b\\u578b\",\"factor_value\":\"d\",\"source\":\"rule\",\"prob\":1.0},{\"position\":1,\"raw_factor\":\"\\u51fa\\u53e3\\u4eab\\u60e0\\u60c5\\u51b5\"w_factor_value\":\"3\",\"factor\":\"\\u51fa\\u53e3\\u4eab\\u60e0\\u60c5\\u51b5\",\"factor_value\":\"d\",\"source\":\"rule\",\"prob\":1.0},{\"position\":2,\"raw_factor\":\"\\u6210\\u5206\\u542b\\u91cf\\uff08\\u9700\\uHS\\/T50\\u65b9\\u6cd5\\u6d4b\\u5f97\\u82b3\\u70c3\\u542b\\u91cf\\uff09\",\"raw_factor_value\":\"\\u82b3\\u70c371.5%,\\u9971\\u548c\\u70c325.36%,\\u6781\\u6027\\u5316\\u5408\\u72693.14%,\\u68c0\\u6d4b\\u65b9\\5:SH\\/T 0753-2005\",\"factor\":\"\\u6210\\u5206\\u542b\\u91cf ( \\u9700\\u7528 hs \\/ t dd \\u65b9\\u6cd5\\u6d4b\\u5f97\\u82b3\\u70c3\\u542b\\u91cf )\",\"factor_value\":\"\\u82b3\\u70c3 dd . d %, \\u9971\\u5470c3 dd . dd %, \\u6781\\u6027\\u5316\\u5408\\u7269 d . dd %, \\u68c0\\u6d4b\\u65b9\\u6cd5 : sh \\/ t dddd - dddd\",\"source\":\"model\",\"prob\":0.9972135424613953},{\"position\":3,\"raw_factor\":\"\\u63O3405\\u65b9\\u6cd5\\uff0c\\u6e29\\u5ea6\\u5728250\\u2103\\u65f6\\u4ee5\\u4f53\\u79ef\\u8ba1\\u7684\\u998f\\u51fa\\u91cf\",\"raw_factor_value\":\"250\\u2103\\u84b8\\u998f\\u51fa\\u82b3\\u70c3\\u4f53\\u79ef\\u5c4e8e1.5%\",\"factor\":\"\\u6309 iso dddd \\u65b9\\u6cd5 , \\u6e29\\u5ea6\\u5728 ddd \\u00b0 C \\u65f6\\u4ee5\\u4f53\\u79ef\\u8ba1\\u7684\\u998f\\u51fa\\u91cf\",\"factor_value\":\"ddd \\u00b0 C \\u84b8\\u998f\\a\\u82b3\\u70c3\\u4f53\\u79ef\\u5c0f\\u4e8e d . d %\",\"source\":\"model\",\"prob\":0.9957844614982605},{\"position\":4,\"raw_factor\":\"\\u998f\\u7a0b\\uff08\\u521d\\u998f\\u70b9\\u6e29\\u5ea6\\u53ca\\u7ec8\\u\\u70b9\\u6e29\\u5ea6\\u7b49\\uff09\",\"raw_factor_value\":\"350-500\\u2103\",\"factor\":\"\\u998f\\u7a0b ( \\u521d\\u998f\\u70b9\\u6e29\\u5ea6\\u53ca\\u7ec8\\u954f\\u70b9\\u6e29\\u5ea6\\u7b49 )\",\"factor_valuedd - ddd \\u00b0 C\",\"source\":\"model\",\"prob\":0.995112955570221},{\"position\":5,\"raw_factor\":\"\\u5b9a\\u4ef7\\u65b9\\u5f0f\\uff08\\u516c\\u5f0f\\u5b9a\\u4ef7\\u3001\\u73b0\\u8d27\\u4ef7\\u7b49)\",\"rawtor_value\":\"\\u73b0\\u8d27\\u4ef7\",\"factor\":\"\\u5b9a\\u4ef7\\u65b9\\u5f0f ( \\u516c\\u5f0f\\u5b9a\\u4ef7 \\u3001 \\u73b0\\u8d27\\u4ef7\\u7b49 )\",\"factor_value\":\"\\u73b0\\u8d27\\u4ef7\",\"source\":\"model\"ob\":0.9992902278900146},{\"position\":6,\"raw_factor\":\"\\u9700\\u8981\\u4e8c\\u6b21\\u7ed3\\u7b97\\u3001\\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"raw_factor_value\":\"\\u65e0\\u9700\\u4e8c\\u6b21\\u7edb97\",\"factor\":\"\\u9700\\u8981\\u4e8c\\u6b21\\u7ed3\\u7b97 \\u3001 \\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"factor_value\":\"\\u65e0\\u9700\\u4e8c\\u6b21\\u7ed3\\u7b97\",\"source\":\"model\",\"prob\":0.998920700073},{\"position\":7,\"raw_factor\":\"\\u7b7e\\u7ea6\\u65e5\\u671f\",\"raw_factor_value\":\"20210226\",\"factor\":\"\\u7b7e\\u7ea6\\u65e5\\u671f\",\"factor_value\":\"dddddddd\",\"source\":\"model\",\"prob\":09287047386169},{\"position\":8,\"raw_factor\":\"\\u8ba1\\u4ef7\\u65e5\\u671f\",\"raw_factor_value\":\"20210226\",\"factor\":\"\\u8ba1\\u4ef7\\u65e5\\u671f\",\"factor_value\":\"dddddddd\",\"source\":\"model\",\"pr0.9730950593948364},{\"position\":9,\"raw_factor\":\"\\u6709\\u65e0\\u6ede\\u671f\\u8d39\\uff08\\u65e0\\u6ede\\u671f\\u8d39\\u3001\\u6ede\\u671f\\u8d39\\u672a\\u786e\\u5b9a\\u3001\\u6ede\\u671f\\u8d39\\u5df2\\3\\u62a5\\uff09\",\"raw_factor_value\":\"\\u65e0\\u6ede\\u671f\\u8d39\",\"factor\":\"\\u6709\\u65e0\\u6ede\\u671f\\u8d39 ( \\u65e0\\u6ede\\u671f\\u8d39 \\u3001 \\u6ede\\u671f\\u8d39\\u672a\\u786e\\u5b9a \\u3001 \\e\\u671f\\u8d39\\u5df2\\u7533\\u62a5 )\",\"factor_value\":\"\\u65e0\\u6ede\\u671f\\u8d39\",\"source\":\"model\",\"prob\":0.9993411898612976}],\"incorrect\":[],\"uncertain\":[]}}";

        Map map = JSONMapper.getInstance().json2Map(json);
        System.out.println(map);
    }
}
